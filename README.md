# üì∂ Unifi Controller - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ.
> [!IMPORTANT]
> –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –Ω–∞ Linux Ubuntu 22.04 LTS (Jammy release).

## –®–∞–≥ 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã.
```
sudo apt update -y
sudo apt upgrade -y
```

## –®–∞–≥ 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Java 17.
```
sudo apt install openjdk-17-jre-headless
```

## –®–∞–≥ 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB 7.0.
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `gnupg` –∏ `curl`, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ:
```
sudo apt-get install gnupg curl
```

2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã–π GPG-–∫–ª—é—á MongoDB:
```
curl -fsSL https://www.mongodb.org/static/pgp/server-7.0.asc | \
   sudo gpg -o /usr/share/keyrings/mongodb-server-7.0.gpg \
   --dearmor
```

3. –î–æ–±–∞–≤—å—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π MongoDB –≤ —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ APT:
```
echo "deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-7.0.gpg ] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/7.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list
```

4. –û–±–Ω–æ–≤–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É –ø–∞–∫–µ—Ç–æ–≤ APT:
```
sudo apt-get update
```

5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç–∞–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é MongoDB:
```
sudo apt-get install -y mongodb-org
```

## –®–∞–≥ 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Unifi –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.
1. –°–∫–∞—á–∞–π—Ç–µ deb –ø–∞–∫–µ—Ç Unifi –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:
```
wget https://dl.ui.com/unifi/7.3.83/unifi_sysvinit_all.deb
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ deb –ø–∞–∫–µ—Ç:
```
dpkg -i unifi_sysvinit_all.deb
```

> [!NOTE]
> –ù–∞ —ç—Ç–æ–º –º–æ–º–µ–Ω—Ç–µ –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–∫–æ–Ω—á–∏—Ç—å.
> 
> **Unifi –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω** –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –∞–¥—Ä–µ—Å–∞–º:
> 
> SSL: https://your-ip-address:8443/
> 
> NoSSL: http://your-ip-address:8080/
> 
> –î–∞–ª—å—à–µ –º—ã —É—Å—Ç–∞–Ω–æ–≤–∏–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä **nginx** –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ SSL –∏ –¥–æ–º–µ–Ω–Ω–æ–º—É –∏–º–µ–Ω–∏.

## –®–∞–≥ 5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nginx (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
1. –°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ nginx:
```
sudo apt update
sudo apt install nginx -y
```

> [!CAUTION]
> **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö –∑–∞–º–µ–Ω–∏—Ç–µ yourdomain.ru –Ω–∞ —Å–≤–æ–π –¥–æ–º–µ–Ω.**

2. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞ –≤ `/etc/nginx/sites-available/` –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```
sudo nano /etc/nginx/sites-available/yourdomain.ru
```

3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞:
```
server {
    listen 80;
    server_name yourdomain.ru; # –ó–∞–º–µ–Ω–∏—Ç—å –∑–¥–µ—Å—å

    location / {
        return 301 https://$host$request_uri;
    }
}

server {
    listen 443 ssl;
    server_name yourdomain.ru; # –ó–∞–º–µ–Ω–∏—Ç—å –∑–¥–µ—Å—å

    location / {
        proxy_pass https://localhost:8443;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

4. –ó–∞—Ç–µ–º –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Å–∞–π—Ç, —Å–æ–∑–¥–∞–≤ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `/etc/nginx/sites-enabled`:
```
sudo ln -s /etc/nginx/sites-available/yourdomain.ru /etc/nginx/sites-enabled/
```

5. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:
```
sudo nginx -t
```

–ï—Å–ª–∏ **–æ—à–∏–±–æ–∫ –Ω–µ—Ç**, —Ç–æ–≥–¥–∞ **–º–æ–∂–Ω–æ –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ**.

–í **–∏–Ω–æ–º —Å–ª—É—á–∞–µ**, **–∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏—Ö**, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.

## –®–∞–≥ 6. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `certbot`, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ **Let's Encrypt**:
```
sudo apt install certbot python3-certbot-nginx
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `certbot` –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
```
sudo certbot --nginx -d yourdomain.ru
```

3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:
```
sudo nginx -t
```
–ï—Å–ª–∏ **–æ—à–∏–±–æ–∫ –Ω–µ—Ç**, —Ç–æ–≥–¥–∞ **–º–æ–∂–Ω–æ –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ**.

–í **–∏–Ω–æ–º —Å–ª—É—á–∞–µ**, **–∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏—Ö**, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.

4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx:
```
sudo systemctl restart nginx
```
5. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É https://yourdomain.ru/
6. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É Unifi –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.
